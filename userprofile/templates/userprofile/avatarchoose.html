{% extends "base.html" %}
{% load i18n %}
{% block title %}{% blocktrans %}{{ user }}'s Dashboard{% endblocktrans %}{% endblock %}
{% block customjs %}
	{% if form.url or form.photo %}
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.dimensions.pack.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.imgareaselect-0.4.2.min.js"></script>
	<script type="text/javascript">
	$(function() {
		function updateValues(img, selection) {
			$("input[name='left']").val(selection.x1);	
			$("input[name='top']").val(selection.y1);	
			$("input[name='right']").val(selection.x2);	
			$("input[name='bottom']").val(selection.y2);	
		}

		$(window).load(function() {

			$("input[name='width']").val($("#cropimage").width());
			$("input[name='height']").val($("#cropimage").height());
			$("a.done").click(function() {
				$("form").submit();
				return false;
			});
			$("#cropimage").imgAreaSelect({ aspectRatio: "1:1", onSelectEnd: updateValues });
		});

    $("a.cancel").click(function() {
      $.post($(this).attr("href"), function(data) {
      	window.close();
      });
      return false;
    });

  	$("a.another").click(function() {
   		$.post($(this).attr("href"), function(data) {
      	window.resizeTo(500, 420);
        window.location = "/profile/avatar/choose/";
   		});
      return false;
		});

		$("input[@type=submit].buttondone").click(function() {
     	var a = $("#child").position();
       $("#id_top").val(a.top);
       $("#id_left").val(a.left);
       $("#id_size").val($("#child").height());
 		});
	});
	</script>
	{% else %}
	<script type="text/javascript">
		$(function() {
     	$("#id_photo").change(function() {
       	$("form").submit();
     	});
		});
	</script>
	{% endif %}
{% endblock %}
{% block content %}
	{% include "userprofile/menu.html" %}
  {% if form.url or form.photo %}
  <form class="commonform" method="post" action="/profile/avatar/crop/">
		<h1>{% trans "Crop&resize the area you want" %}</h1>
		<p class="title">
			<a class="done" style="margin-right: 20px;" href="{{ request.path }}">{% trans 'Done' %}</a>
			<a class="another" style="margin-right: 20px;" href="/profile/avatartemp/delete/">{% trans 'Select anoter image' %}</a>
			<a class="cancel" href="/profile/avatartemp/delete/">{% trans 'Cancel' %}</a>
		</p>
    <input type="hidden" name="width" value="0"/>
    <input type="hidden" name="height" value="0"/>
    <input type="hidden" name="top" value="0"/>
    <input type="hidden" name="top" value="0"/>
    <input type="hidden" name="bottom" value="0"/>
    <input type="hidden" name="left" value="0"/>
    <input type="hidden" name="right" value="0"/>
  </form>
	<img src="{{ profile.get_avatartemp_url }}" id="cropimage" />
	{% else %}
  <form class="commonform" action="" method="post" enctype="multipart/form-data">
		<h1>{% trans "Choose the source of your avatar" %}</h1>
  	<div class="avatar">
    	<img src="{{ profile.get_avatar96_url }}" />
  	</div>
		<p class="title">{% trans "You have 3 options to select the image file you want as avatar in your profile:" %}</p>
		<ol>
			<li>
    		<label for="id_url">{% trans "Select an image from a remote URL:" %}</label>
    		{{ form.url }}
				<input type="submit" value="{% trans "Done" %}" />
			</li>
			<li>
    		<label for="id_photo">{% trans "Select an image from disk:" %}</label>
    		{{ form.photo }}
			</li>
			{% if websearch %}
			<li>
				<a href="/profile/avatar/search/">{% trans "Search for an image on Picasa Web" %}</a>
			</li>
			{% endif %}
		</ol>
  </form>
	{% if form.errors %}
	{{ form.errors }}
	{% endif %}
	{% endif %}
{% endblock %}
